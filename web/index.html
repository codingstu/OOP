<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Python æ•°æ®åˆ†æ Aå· | ç­”å·æ¼”ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* ä½¿ç”¨è¡¬çº¿å­—ä½“ï¼Œæ›´åƒè¯•å· */
        body { font-family: 'Inter', 'Noto Serif SC', serif; background-color: #f3f4f6; color: #1e293b; }
        .paper-card { background: white; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border-radius: 8px; padding: 24px; margin-bottom: 24px; }
        .question-title { font-family: 'Noto Serif SC', serif; font-size: 1.25rem; font-weight: 700; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-bottom: 16px; color: #1e3a8a; }
        .sub-question { font-weight: 700; color: #475569; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; font-size: 0.95rem; background: #f1f5f9; padding: 6px 12px; border-radius: 4px; }
        .score-badge { background: #fee2e2; color: #b91c1c; font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; border: 1px solid #fecaca; }
        .result-box { border: 1px dashed #cbd5e1; padding: 12px; border-radius: 6px; background: #f8fafc; font-family: monospace; font-size: 0.9rem; }
        .nav-btn { padding: 10px 20px; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .nav-btn.active { color: #2563eb; border-color: #2563eb; background: #eff6ff; }
        table { font-size: 0.8rem; width: 100%; border-collapse: collapse; }
        th { background: #e2e8f0; padding: 6px; text-align: left; font-weight: 600; border: 1px solid #cbd5e1; }
        td { padding: 6px; border: 1px solid #cbd5e1; }
    </style>
</head>
<body>
    <div id="app" class="max-w-7xl mx-auto px-4 py-8">
        <header class="mb-8 flex justify-between items-end border-b pb-4">
            <div>
                <h1 class="text-2xl font-bold text-slate-800">è¥¿å®‰è´¢ç»å¤§å­¦ è¯¾ç¨‹è€ƒæ ¸è¯•å·ï¼ˆAï¼‰</h1>
                <p class="text-sm text-slate-500 mt-1">2025-2026-1 å­¦æœŸ | Pythonæ•°æ®åˆ†æä¸åº”ç”¨ | å¤§ä½œä¸šå±•ç¤º</p>
            </div>
            <div class="text-right">
                <div class="text-sm font-bold text-slate-400">æ€»åˆ†</div>
                <div class="text-3xl font-bold text-red-600 font-serif">100åˆ†</div>
            </div>
        </header>

        <nav class="flex bg-white rounded-lg shadow-sm border mb-8 overflow-x-auto">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab=tab.id" class="nav-btn flex-1 whitespace-nowrap" :class="{active:currentTab===tab.id}">
                {{ tab.name }}
            </button>
        </nav>

        <div v-if="loading" class="text-center py-12 text-blue-600 font-bold">æ­£åœ¨è®¡ç®—è¯•å·æ•°æ®...</div>
        <div v-if="error" class="bg-red-50 text-red-700 p-4 rounded border border-red-200 mb-6">âŒ è¿æ¥åç«¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ run.py</div>

        <div v-if="!loading && currentTab==='q1' && q1" class="paper-card">
            <h2 class="question-title">ä¸€ã€ç¬¬1å¤§é¢˜ (20åˆ†) - é”€å”®æ•°æ®å¤„ç†</h2>

            <div class="mb-6">
                <div class="sub-question"><span>(1) ä»å­—ç¬¦ä¸²ä¸­æå–æ‰€æœ‰é”€å”®é¢æ•°æ® [4åˆ†]</span></div>
                <div class="result-box break-all">{{ q1.raw_data.join(', ') }}</div>
            </div>

            <div class="mb-6">
                <div class="sub-question"><span>(2) è®¡ç®—è¯¥åº—é“º2024å¹´çš„å¹´é”€å”®é¢æ€»å’Œ [4åˆ†]</span></div>
                <div class="result-box text-lg font-bold text-blue-700">æ€»é”€å”®é¢: {{ q1.total }} å…ƒ</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <div class="sub-question"><span>(3) æ‰¾å‡ºå…¨å¹´é”€å”®é¢æœ€é«˜çš„æœˆä»½ [2åˆ†]</span></div>
                    <div class="result-box">{{ q1.max.month }}æœˆ (é‡‘é¢: {{q1.max.value}})</div>
                </div>
                <div>
                    <div class="sub-question"><span>(3) æ‰¾å‡ºå…¨å¹´é”€å”®é¢æœ€ä½çš„æœˆä»½ [2åˆ†]</span></div>
                    <div class="result-box">{{ q1.min.month }}æœˆ (é‡‘é¢: {{q1.min.value}})</div>
                </div>
            </div>

            <div>
                <div class="sub-question"><span>(4) è®¡ç®—å­£åº¦å¹³å‡é”€å”®é¢ [4åˆ†]</span></div>
                <div class="grid grid-cols-4 gap-2 text-center mt-2">
                    <div v-for="(v,k) in q1.quarter_avg" class="bg-slate-50 border p-2 rounded">
                        <div class="text-xs font-bold text-slate-400">{{k}}</div>
                        <div class="font-bold">{{v}}</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="!loading && currentTab==='q2' && q2" class="paper-card">
            <h2 class="question-title">äºŒã€ç¬¬2å¤§é¢˜ (20åˆ†) - è´¢åŠ¡æ”¶æ”¯ç®¡ç†</h2>

            <div class="mb-6">
                <div class="sub-question"><span>(2) è®¡ç®—å¹¶æ‰“å°å‡ºæ€»æ”¶å…¥ã€æ€»æ”¯å‡ºå’Œå½“æœˆç»“ä½™ [6åˆ†]</span></div>
                <div class="flex gap-4 result-box">
                    <div class="text-green-600">æ€»æ”¶å…¥: +{{q2.summary.income}}</div>
                    <div class="text-red-600">æ€»æ”¯å‡º: -{{q2.summary.expense}}</div>
                    <div class="text-blue-600 font-bold">ç»“ä½™: {{q2.summary.balance}}</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <div class="sub-question"><span>(1) & (4) åˆ›å»ºè®°è´¦æœ¬å¹¶æ‰“å°æ‰€æœ‰è®°å½• [8åˆ†]</span></div>
                    <div class="h-64 overflow-y-auto border"><table class="w-full">
                        <thead><tr><th>æ—¥æœŸ</th><th>æè¿°</th><th>é‡‘é¢</th><th>ç±»å‹</th></tr></thead>
                        <tbody><tr v-for="r in q2.all_records"><td>{{r.æ—¥æœŸ}}</td><td>{{r.æè¿°}}</td><td>{{r.é‡‘é¢}}</td><td>{{r.ç±»å‹}}</td></tr></tbody>
                    </table></div>
                </div>
                <div>
                    <div class="sub-question"><span>(3) ç­›é€‰å¹¶æ‰“å°å‡ºæ‰€æœ‰â€œæ”¯å‡ºâ€ç±»å‹çš„äº¤æ˜“ [6åˆ†]</span></div>
                    <div class="h-64 overflow-y-auto border border-red-200"><table class="w-full">
                        <thead class="bg-red-50 text-red-700"><tr><th>æ—¥æœŸ</th><th>æè¿°</th><th>é‡‘é¢</th></tr></thead>
                        <tbody><tr v-for="r in q2.expense_records"><td>{{r.æ—¥æœŸ}}</td><td>{{r.æè¿°}}</td><td class="text-red-600">{{r.é‡‘é¢}}</td></tr></tbody>
                    </table></div>
                </div>
            </div>
        </div>

        <div v-if="!loading && currentTab==='q3'" class="paper-card">
            <h2 class="question-title">ä¸‰ã€ç¬¬3å¤§é¢˜ (20åˆ†) - ä¸ªäººæ‰€å¾—ç¨è®¡ç®—å™¨</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div class="sub-question"><span>(1) ç”¨æˆ·è¾“å…¥ (åŒ…å«éªŒè¯) [6åˆ†]</span></div>
                    <div class="bg-slate-50 p-4 rounded border space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <label class="text-xs">æœˆæ”¶å…¥ <input v-model="q3In.income" type="number" class="w-full border p-1 rounded"></label>
                            <label class="text-xs">ä¸‰é™©ä¸€é‡‘ <input v-model="q3In.insurance" type="number" class="w-full border p-1 rounded"></label>
                            <label class="text-xs">ä¸“é¡¹æ‰£é™¤ <input v-model="q3In.special" type="number" class="w-full border p-1 rounded"></label>
                            <label class="text-xs">å…¶ä»– <input v-model="q3In.other" type="number" class="w-full border p-1 rounded"></label>
                        </div>
                        <button @click="calcTax" class="w-full bg-blue-600 text-white text-sm font-bold py-2 rounded">é‡æ–°è®¡ç®—</button>
                    </div>
                </div>

                <div>
                    <div class="sub-question"><span>(2) & (3) è®¡ç®—é€»è¾‘ä¸ç»“æœè¾“å‡º [14åˆ†]</span></div>
                    <div v-if="q3Out" class="result-box space-y-2">
                        <div class="flex justify-between"><span>æœˆåº”çº³ç¨æ‰€å¾—é¢:</span> <b>{{q3Out.taxable_month}}</b></div>
                        <div class="flex justify-between"><span>å…¨å¹´åº”çº³ç¨æ‰€å¾—é¢:</span> <b>{{q3Out.taxable_year}}</b></div>
                        <div class="flex justify-between text-yellow-700"><span>å…¨å¹´åº”çº³ç¨é¢:</span> <b>{{q3Out.tax_year.toFixed(2)}}</b></div>
                        <div class="flex justify-between text-red-600 border-t pt-1"><span>æœˆåº¦ç¨é¢:</span> <b>{{q3Out.tax_month.toFixed(2)}}</b></div>
                        <div class="flex justify-between text-green-600 text-lg"><span>ç¨åæ”¶å…¥:</span> <b>{{q3Out.net_income.toFixed(2)}}</b></div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="!loading && currentTab==='q4' && q4" class="paper-card">
            <h2 class="question-title">å››ã€ç¬¬4å¤§é¢˜ (20åˆ†) - äººäº‹è´¢åŠ¡æ•°æ®åˆ†æ</h2>

            <div class="grid grid-cols-2 gap-6 mb-6">
                <div>
                    <div class="sub-question"><span>(1) å¯¼å…¥å¹¶æ˜¾ç¤ºå‰10/å10è¡Œ, è¡Œåˆ—æ•° [2åˆ†]</span></div>
                    <div class="result-box mb-2">è¡Œæ•°: {{q4.shape[0]}}, åˆ—æ•°: {{q4.shape[1]}}</div>
                    <div class="h-32 overflow-y-auto border"><table class="w-full">
                        <thead><tr><th v-for="c in q4.columns">{{c}}</th></tr></thead>
                        <tbody><tr v-for="r in q4.head_10"><td v-for="c in q4.columns">{{r[c]}}</td></tr></tbody>
                    </table></div>
                </div>
                <div>
                    <div class="sub-question"><span>(2) Groupby å­¦å†æ€§åˆ«å¹³å‡å·¥èµ„ [3åˆ†]</span></div>
                    <div class="h-40 overflow-y-auto border"><table class="w-full">
                        <thead><tr><th>å­¦å†</th><th>æ€§åˆ«</th><th>å¹³å‡å·¥èµ„</th></tr></thead>
                        <tbody><tr v-for="r in q4.groupby_salary"><td>{{r.å­¦å†}}</td><td>{{r.æ€§åˆ«}}</td><td>{{r.åº”å‘å·¥èµ„}}</td></tr></tbody>
                    </table></div>
                </div>
            </div>

            <div class="mb-6">
                <div class="sub-question"><span>(3) å¤„ç†ç¼ºå¤±å€¼(æ›¿æ¢ä¸ºæ— )ä¸é‡å¤å€¼ [3åˆ†]</span></div>
                <div class="result-box flex gap-4">
                    <span>é‡å¤å€¼: {{q4.duplicates_count}} (å·²åˆ )</span>
                    <span>å»é‡åè§„æ¨¡: {{q4.shape_after_dedup[0]}}è¡Œ</span>
                    <span>ç¼ºå¤±å€¼: å·²æ›¿æ¢ä¸º"æ— "</span>
                </div>
            </div>

            <div class="mb-6">
                <div class="sub-question"><span>(4) å¢åˆ æ”¹æŸ¥æ“ä½œ [10åˆ†]</span></div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4 text-sm">
                    <div class="bg-slate-50 p-2 border">â‘  ç¦»èŒå æ¯”: <b>{{q4.leaver_ratio}}</b></div>
                    <div class="bg-slate-50 p-2 border">â‘¡ å·¥èµ„æå€¼: {{q4.salary_max}} / {{q4.salary_min}}</div>
                    <div class="bg-slate-50 p-2 border">â‘¢ å­¦å†: <span v-for="(v,k) in q4.edu_ratio" class="mr-1">{{k}}({{v}}%)</span></div>
                    <div class="bg-slate-50 p-2 border text-red-600">â‘¤ åˆ é™¤: {{q4.delete_count}}äºº</div>
                </div>

                <div class="border rounded p-3 bg-slate-50">
                    <h4 class="font-bold text-sm mb-2 text-blue-700">æœ€ç»ˆå¤„ç†åæ•°æ®é¢„è§ˆ (éªŒè¯â‘£å¢åŠ å’Œâ‘¤åˆ é™¤ç»“æœ):</h4>
                    <p class="text-xs text-slate-500 mb-2">æ˜¾ç¤ºå‰5è¡Œå’Œå5è¡Œ (æ³¨æ„è§‚å¯Ÿæœ€åä¸€è¡Œæ–°å¢çš„GH993)</p>
                    <div class="overflow-x-auto"><table class="w-full text-xs whitespace-nowrap bg-white">
                        <thead><tr><th v-for="c in q4.columns">{{c}}</th></tr></thead>
                        <tbody>
                            <tr v-for="r in q4.final_head"><td v-for="c in q4.columns">{{r[c]}}</td></tr>
                            <tr><td :colspan="q4.columns.length" class="text-center bg-gray-100">... (ä¸­é—´æ•°æ®çœç•¥) ...</td></tr>
                            <tr v-for="r in q4.final_tail" class="bg-yellow-50"><td v-for="c in q4.columns">{{r[c]}}</td></tr>
                        </tbody>
                    </table></div>
                </div>
            </div>

            <div>
                <div class="sub-question"><span>(5) å¯¼å‡ºå¤„ç†åçš„ç»“æœæ•°æ® [2åˆ†]</span></div>
                <a href="/api/hr/export" target="_blank" class="inline-block bg-green-600 text-white px-4 py-2 rounded text-sm font-bold shadow hover:bg-green-700">
                    ğŸ“¥ ä¸‹è½½ Excel (4-1_Result.xlsx)
                </a>
            </div>
        </div>

        <div v-if="!loading && currentTab==='q5' && q5" class="paper-card">
            <h2 class="question-title">äº”ã€ç¬¬5å¤§é¢˜ (20åˆ†) - äººå£æ•°æ®å¯è§†åŒ–</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="border p-2 rounded">
                    <div class="text-center text-xs font-bold text-slate-500 mb-2">(1) åŸä¹¡æŸ±çŠ¶å›¾ [5åˆ†]</div>
                    <div id="c1" style="height:300px;"></div>
                </div>
                <div class="border p-2 rounded">
                    <div class="text-center text-xs font-bold text-slate-500 mb-2">(2) ç”·å¥³æ¯”ä¾‹é¥¼å›¾ [5åˆ†]</div>
                    <div id="c2" style="height:300px;"></div>
                </div>
                <div class="border p-2 rounded">
                    <div class="text-center text-xs font-bold text-slate-500 mb-2">(3) è¶‹åŠ¿æŠ˜çº¿å›¾ [5åˆ†]</div>
                    <div id="c3" style="height:300px;"></div>
                </div>
                <div class="border p-2 rounded">
                    <div class="text-center text-xs font-bold text-slate-500 mb-2">(4) æ•£ç‚¹å›¾ [5åˆ†]</div>
                    <div id="c4" style="height:300px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick, watch } = Vue;
        createApp({
            setup() {
                const currentTab = ref('q1');
                const tabs = [
                    {id:'q1',name:'ç¬¬ä¸€é¢˜ (20åˆ†)'}, {id:'q2',name:'ç¬¬äºŒé¢˜ (20åˆ†)'}, {id:'q3',name:'ç¬¬ä¸‰é¢˜ (20åˆ†)'},
                    {id:'q4',name:'ç¬¬å››é¢˜ (20åˆ†)'}, {id:'q5',name:'ç¬¬äº”é¢˜ (20åˆ†)'}
                ];
                const loading=ref(true), error=ref(false);
                const q1=ref(null), q2=ref(null), q4=ref(null), q5=ref(null);
                const q3In=ref({income:15000, insurance:2000, special:1500, other:0});
                const q3Out=ref(null);

                const load = async () => {
                    try {
                        const [r1,r2,r4,r5] = await Promise.all([
                            fetch('/api/sales').then(r=>r.json()), fetch('/api/finance').then(r=>r.json()),
                            fetch('/api/hr').then(r=>r.json()), fetch('/api/population').then(r=>r.json())
                        ]);
                        q1.value=r1; q2.value=r2; q4.value=r4.data; q5.value=r5;
                        calcTax();
                    } catch(e) { error.value=true; } finally { loading.value=false; }
                };
                const calcTax = async () => {
                    const r = await fetch('/api/tax',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(q3In.value)});
                    const d = await r.json(); q3Out.value=d.data;
                };
                const render = () => {
                    setTimeout(() => {
                        if(!q5.value || !document.getElementById('c1')) return;
                        const d = q5.value;
                        echarts.init(document.getElementById('c1')).setOption({tooltip:{trigger:'axis'},xAxis:{data:d.years},yAxis:{},series:[{type:'bar',data:d.urban,name:'åŸ'},{type:'bar',data:d.rural,name:'ä¹¡'}]});
                        echarts.init(document.getElementById('c2')).setOption({tooltip:{trigger:'item'},series:[{type:'pie',data:d.pie_2022}]});
                        echarts.init(document.getElementById('c3')).setOption({tooltip:{trigger:'axis'},xAxis:{data:d.years},yAxis:{scale:true},series:[{type:'line',data:d.urban},{type:'line',data:d.rural}]});
                        echarts.init(document.getElementById('c4')).setOption({tooltip:{},xAxis:{scale:true},yAxis:{scale:true},series:[{type:'scatter',data:d.total.map((t,i)=>[t,d.urban[i]])}]});
                    }, 200);
                };
                watch(currentTab, v=>{if(v==='q5') render()});
                onMounted(load);
                return {currentTab, tabs, loading, error, q1, q2, q3In, q3Out, q4, q5, calcTax};
            }
        }).mount('#app');
    </script>
</body>
</html>